<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport"
    content="width=device-width,initial-scale=1,user-scalable=0,minimum-scale=1.0,maximum-scale=1.0" />
  <meta name="author" content="火星科技 http://mars3d.cn " />
  <meta name="apple-touch-fullscreen" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="x5-fullscreen" content="true" />
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1" />
  <!-- 标题及搜索关键字 -->
  <meta name="keywords" content="火星科技,cesium,3D,GIS,marsgis,三维,地球,地图,开发,框架,系统,示例,资料,模型,离线,外包,合肥,安徽,中国" />
  <meta name=description
    content="火星科技 合肥火星 合肥火星科技 合肥火星科技有限公司 leaflet leaflet框架 leaflet开发 cesium cesium开发 cesium框架 三维 地球 模型  gis marsgis 地图离线 地图开发 地图框架 地图外包 框架 开发 外包  地图离线 二维地图 三维地图 全景漫游 地理信息系统 云GIS 三维GIS GIS平台 WebGIS" />

  <link rel="shortcut icon" type="image/x-icon" href="https://muyao1987.gitee.io/cdn/marsgis.cn/favicon/favicon.ico" />
  <title>功能示例 | Mars3D | 三维地图 | 火星科技 | 合肥火星科技有限公司</title>

  <!--第三方lib-->
  <script type="text/javascript" src="../lib/include-lib.js" libpath="../lib/"
    include="jquery,font-awesome,bootstrap,layer,haoutil,mars3d"></script>

  <link href="css/style.css" rel="stylesheet" />
  <link href="css/divGraphic.css" rel="stylesheet" />

</head>

<body class="dark">
  <!--加载前进行操作提示，优化用户体验-->
  <div id="mask" class="signmask" onclick="removeMask()"></div>

  <div id="mars3dContainer" class="mars3d-container"></div>

  <!-- 面板 -->
  <!-- <div class="infoview"> </div> -->
  <style>
    .title {
      font-size: 10px;

    }

    .label-unit {
      font-size: 4px !important;
    }

    .marsTiltPanel-theme-red {
      width: 360px;
    }
  </style>
  <script src="./js/common.js"></script>
  <script type="text/javascript">
    "use script"; //开发环境建议开启严格模式

    var map;
    let graphicLayer;
    function initMap(options) {
      //合并属性参数，可覆盖config.json中的对应配置
      let mapOptions = mars3d.Util.merge(options, {
        scene: {
          center: { lat: 31.84646, lng: 117.223095, alt: 790, heading: 189, pitch: -13 },
          clock: {
            startTime: "2017/08/25 08:00:00",
            stopTime: "2017/08/25 08:01:30",
          },
        },
        control: {
          // animation: true, //是否创建 动画小器件，左下角仪表
          timeline: true, //是否显示 时间线控件
        },
      });

      //创建三维地球场景
      map = new mars3d.Map("mars3dContainer", mapOptions);

      //创建DIV数据图层
      graphicLayer = new mars3d.layer.GraphicLayer();
      map.addLayer(graphicLayer);

      //加模型
      let tilesetLayer = new mars3d.layer.TilesetLayer({
        name: "合肥天鹅湖",
        type: "3dtiles",
        url: "//data.mars3d.cn/3dtiles/qx-teh/tileset.json",
        position: { lng: 117.218434, lat: 31.81807, alt: 163 },
        flatHeight: 120,
        maximumScreenSpaceError: 16,
        maximumMemoryUsage: 1024,
        dynamicScreenSpaceError: true,
        cullWithChildrenBounds: false,
        skipLevelOfDetail: true,
        preferLeaves: true,
      });
      map.addLayer(tilesetLayer);

      showDitailInfo();
    }

    const arrData = [
      {
        title: "中国安徽广播电视台",
        description: "安徽广播电视台（AHTV）是集广播、电视、报纸、</br>网络、新媒体等多种业务为一体的省级广播电视综合传</br>媒机构。",
        center: { lat: 31.817346, lng: 117.216403, alt: 342, heading: 168, pitch: -13, duration: 2 },
        position: [117.219971, 31.808482, 264.9],
        startTime: "2017/08/25 08:00:04",
        endTime: "2017/08/25 08:00:07",
      },
      {
        title: "合肥市政务中心",
        description: "合肥市人民政府政务服务中心为市委、市政府派出机构，</br>服务中心成立党工委和管委会，内设综合处、</br>督查处、审批项目协调处",
        center: { lat: 31.818069, lng: 117.221763, alt: 173, heading: 355, pitch: -5, duration: 3 },
        position: [117.222139, 31.822782, 166.6],
        startTime: "2017/08/25 08:00:09",
        endTime: "2017/08/25 08:00:12",
      },
      {
        title: "合肥市文化旅游局",
        description: "合肥市文化和旅游局和市文化和旅游局是市政府工作部门，</br>为正处级，加挂市广播电视新闻出版局牌子",
        center: { lat: 31.813929, lng: 117.217225, alt: 142, heading: 330, pitch: -14, duration: 3 },
        position: [117.215827, 31.818229, 84.6],
        startTime: "2017/08/25 08:00:14",
        endTime: "2017/08/25 08:00:17",
      },
      {
        title: "合肥大剧院",
        description: "合肥大剧院又名天鹅湖大剧院，主要由歌剧厅、</br>音乐厅、多功能厅等部分组成。",
        center: { lat: 31.815301, lng: 117.218273, alt: 107, heading: 11, pitch: -13, duration: 3 },
        position: [117.218782, 31.8176, 64.9],
        startTime: "2017/08/25 08:00:19",
        endTime: "2017/08/25 08:00:22",
      },
    ];

    const centerArr = [];
    function showDitailInfo() {
      for (let i = 0; i < arrData.length; i++) {
        //动态坐标属性
        let property = new Cesium.SampledPositionProperty();
        const startTime = Cesium.JulianDate.fromDate(new Date(arrData[i].startTime));
        const endTime = Cesium.JulianDate.fromDate(new Date(arrData[i].endTime));

        property.addSample(startTime, Cesium.Cartesian3.fromDegrees(...arrData[i].position)); //此刻显示
        property.addSample(endTime, Cesium.Cartesian3.fromDegrees(...arrData[i].position)); //此刻不显示

        const stopTime = new Date(arrData[i].endTime).getSeconds() - new Date(arrData[i].startTime).getSeconds();

        arrData[i].center.stop = stopTime; //停顿视角
        centerArr.push(arrData[i].center); //center集合

        const graphic = new mars3d.graphic.DivGraphic({
          position: property,
          style: {
            html: `<div class="marsTiltPanel marsTiltPanel-theme-red">
          <div class="marsTiltPanel-wrap">
              <div class="area">
                  <div class="arrow-lt"></div>
                  <div class="b-t"></div>
                  <div class="b-r"></div>
                  <div class="b-b"></div>
                  <div class="b-l"></div>
                  <div class="arrow-rb"></div>
                  <div class="label-wrap">
                      <div class="title">${arrData[i].title}</div>
                      <div class="label-content">
                          <div class="data-li">
                              <div class="data-value"><span class="label-unit">${arrData[i].description}</span>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
              <div class="b-t-l"></div>
              <div class="b-b-r"></div>
          </div>
          <div class="arrow" ></div>
      </div>`,
            horizontalOrigin: Cesium.HorizontalOrigin.LEFT,
            verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
          },
        });
        graphicLayer.addGraphic(graphic);
      }
      map.setCameraViewList(centerArr); //视角
    }
  </script>
</body>

</html>
