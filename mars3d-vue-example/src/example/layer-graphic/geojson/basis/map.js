import * as mars3d from "mars3d"

export let map // mars3d.Map三维地图对象
export let graphicLayer // 矢量图层对象
export const eventTarget = new mars3d.BaseClass() // 事件对象，用于抛出事件到面板中

// 需要覆盖config.json中地图属性参数（当前示例框架中自动处理合并）
export const mapOptions = {
  scene: {
    center: { lat: 30.402686, lng: 116.303632, alt: 48692, heading: 3, pitch: -43 }
  }
}

/**
 * 初始化地图业务，生命周期钩子函数（必须）
 * 框架在地图初始化完成后自动调用该函数
 * @param {mars3d.Map} mapInstance 地图对象
 * @returns {void} 无
 */
export function onMounted(mapInstance) {
  map = mapInstance // 记录首次创建的map

  showDraw()
}

/**
 * 释放当前地图业务的生命周期函数
 * @returns {void} 无
 */
export function onUnmounted() {
  map = null
}

function removeLayer() {
  if (graphicLayer) {
    graphicLayer.clear()
    map.removeLayer(graphicLayer, true)
    graphicLayer = null
  }
  if (tilesetLayer) {
    map.removeLayer(tilesetLayer, true)
    tilesetLayer = null
  }
}

/**
 * 平台通过draw标绘后保存的geojosn数据（已经内置style了，无需配置symbol）
 */
export function showDraw(isFlyTo) {
  removeLayer()

  graphicLayer = new mars3d.layer.GeoJsonLayer({
    name: "标绘示例数据",
    url: "//data.mars3d.cn/file/geojson/mars3d-draw.json",
    popup: "{type} {name}",
    queryParameters: {
      token: "mars3d" // 可以传自定义url参数，如token等
    },
    symbol: {
      merge: true,
      styleOptions: {
        // 高亮时的样式
        highlight: {
          type: "click",
          opacity: 0.9
        }
      }
    },
    flyTo: isFlyTo
  })
  map.addLayer(graphicLayer)

  // load事件,必须在load完成前绑定才能监听
  graphicLayer.on(mars3d.EventType.load, function (event) {
    if (event.layer) {
      console.log("数据加载完成", event)
    }
  })

  setTimeout(() => {
    // readyPromise是可以load加载数据完成后去获取
    graphicLayer.readyPromise.then(function (layer) {
      console.log("readyPromise:数据加载完成", layer)
    })
  }, 5000)

  // 单击事件
  graphicLayer.on(mars3d.EventType.click, function (event) {
    console.log("单击了图层", event)
  })
}

/**
 * 点数据
 */
export function showPoint() {
  removeLayer()
  graphicLayer = new mars3d.layer.GeoJsonLayer({
    name: "体育设施点",
    url: "//data.mars3d.cn/file/geojson/hfty-point.json",
    symbol: {
      styleOptions: {
        image: "img/marker/mark-red.png",
        verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
        scale: 1,
        scaleByDistance: true,
        scaleByDistance_far: 20000,
        scaleByDistance_farValue: 0.5,
        scaleByDistance_near: 1000,
        scaleByDistance_nearValue: 1,
        // setHeight: 5000, //指定高度
        label: {
          text: "{项目名称}",
          font_size: 25,
          color: "#ffffff",
          outline: true,
          outlineColor: "#000000",
          pixelOffsetY: -25,
          scaleByDistance: true,
          scaleByDistance_far: 80000,
          scaleByDistance_farValue: 0.5,
          scaleByDistance_near: 1000,
          scaleByDistance_nearValue: 1,
          distanceDisplayCondition: true,
          distanceDisplayCondition_far: 80000,
          distanceDisplayCondition_near: 0
        }
      }
    },
    popup: [
      { field: "项目名称", name: "项目名称" },
      { field: "建设性质", name: "建设性质" },
      { field: "设施级别", name: "设施级别" },
      { field: "所属区县", name: "所属区县" },
      { field: "建筑内容及", name: "建筑内容" },
      { field: "新增用地（", name: "新增用地" },
      { field: "开工", name: "开工" },
      { field: "总投资（万", name: "总投资" },
      { field: "资金来源", name: "资金来源" },
      { field: "初步选址", name: "初步选址" },
      { field: "设施类型", name: "设施类型" },
      { field: "设施等级", name: "设施等级" },
      { field: "所在区县", name: "所在区县" },
      { field: "具体位置", name: "具体位置" },
      { field: "建设内容（", name: "建设内容" },
      { field: "用地面积（", name: "用地面积", format: "mars3d.MeasureUtil.formatArea" },
      { field: "设施规模（", name: "设施规模" },
      { field: "举办者类型", name: "举办者类型" },
      { field: "开工时间", name: "开工时间" },
      { field: "总投资额（", name: "总投资额", unit: "亿元" },
      { field: "项目推进主", name: "项目推进主体" },
      { field: "项目进度", name: "项目进度" },
      { field: "项目来源", name: "项目来源" },
      { field: "备注", name: "备注" }
    ],
    flyTo: true
  })
  map.addLayer(graphicLayer)

  // 绑定事件
  graphicLayer.on(mars3d.EventType.load, function (event) {
    console.log("数据加载完成", event)
  })
  graphicLayer.on(mars3d.EventType.click, function (event) {
    console.log("单击了图层", event)
  })
}

/**
 * 全国省界
 */
export function showChinaLine() {
  removeLayer()

  graphicLayer = new mars3d.layer.GeoJsonLayer({
    name: "全国省界",
    url: "//data.mars3d.cn/file/geojson/areas/100000_full.json",
    format: simplifyGeoJSON, // 用于自定义处理geojson
    symbol: {
      type: "polylineP",
      styleOptions: {
        width: 2,
        materialType: mars3d.MaterialType.LineFlow,
        materialOptions: {
          color: "#00ffff",
          image: "img/textures/fence-line.png",
          speed: 10,
          repeat_x: 10
        },
        distanceDisplayCondition: true,
        distanceDisplayCondition_far: 12000000,
        distanceDisplayCondition_near: 100000,
        label: {
          text: "{name}",
          position: "{center}", // 省会位置center
          font_size: 30,
          color: "#ffffff",
          outline: true,
          outlineColor: "#000000",
          scaleByDistance: true,
          scaleByDistance_far: 60000000,
          scaleByDistance_farValue: 0.2,
          scaleByDistance_near: 1000000,
          scaleByDistance_nearValue: 1,
          distanceDisplayCondition: true,
          distanceDisplayCondition_far: 10000000,
          distanceDisplayCondition_near: 100000,
          setHeight: 10000
        }
      }
    },
    flyTo: true
  })
  map.addLayer(graphicLayer)

  // 绑定事件
  graphicLayer.on(mars3d.EventType.load, function (event) {
    console.log("数据加载完成", event)
  })
}

// 简化geojson的坐标
function simplifyGeoJSON(geojson) {
  try {
    geojson = turf.simplify(geojson, { tolerance: 0.0001, highQuality: true, mutate: true })
  } catch (e) {
    //
  }
  return geojson
}

/**
 * 显示合肥区域面
 */
export function showRegion() {
  removeLayer()

  graphicLayer = new mars3d.layer.GeoJsonLayer({
    name: "合肥市",
    url: "//data.mars3d.cn/file/geojson/areas/340100_full.json",
    symbol: {
      styleOptions: {
        fill: true,
        randomColor: true, // 随机色
        opacity: 0.3,
        outline: true,
        outlineStyle: {
          color: "#FED976",
          width: 3,
          opacity: 1
        },
        // 高亮时的样式
        highlight: {
          opacity: 0.9
        },
        label: {
          // 面中心点，显示文字的配置
          text: "{name}", // 对应的属性名称
          opacity: 1,
          font_size: 40,
          color: "#ffffff",

          font_family: "楷体",
          outline: true,
          outlineColor: "#000000",
          outlineWidth: 3,

          background: false,
          backgroundColor: "#000000",
          backgroundOpacity: 0.1,

          font_weight: "normal",
          font_style: "normal",

          scaleByDistance: true,
          scaleByDistance_far: 20000000,
          scaleByDistance_farValue: 0.1,
          scaleByDistance_near: 1000,
          scaleByDistance_nearValue: 1,

          distanceDisplayCondition: false,
          distanceDisplayCondition_far: 10000,
          distanceDisplayCondition_near: 0,
          visibleDepth: false
        }
      }
    },
    popup: "{name}",
    // "tooltip": "{name}",
    flyTo: true
  })
  map.addLayer(graphicLayer)

  // 绑定事件
  graphicLayer.on(mars3d.EventType.load, function (event) {
    console.log("数据加载完成", event)
  })
  graphicLayer.on(mars3d.EventType.click, function (event) {
    console.log("单击了图层", event)
  })
}

// 规划面
export function showPlanningSurface() {
  removeLayer()

  map.setCameraView({ lat: 31.591382, lng: 120.718945, alt: 784, heading: 279, pitch: -67 })

  graphicLayer = new mars3d.layer.GeoJsonLayer({
    id: 1987,
    name: "用地规划",
    // 1.支持URL
    // url: "//data.mars3d.cn/file/geojson/guihua.json",
    // 2.也支持直接传入数据
    data: {
      type: "FeatureCollection",
      name: "用地规划",
      features: [
        {
          type: "Feature",
          properties: { Id: 0, 名称: "G1", 类型: "公园绿地" },
          geometry: {
            type: "Polygon",
            coordinates: [
              [
                [120.713841491273385, 31.593506790155303],
                [120.713816509332702, 31.593510546143463],
                [120.713874556610989, 31.59405483428062],
                [120.71398867842656, 31.594140059673361],
                [120.714005578706406, 31.594136529360409],
                [120.714021570535266, 31.594130668041011],
                [120.714036217818986, 31.594122633377708],
                [120.714049119663287, 31.594112645036596],
                [120.714059925752522, 31.5941009774455],
                [120.714068343318317, 31.594087945993895],
                [120.714074139060287, 31.594073905921174],
                [120.714077158366294, 31.59405924285166],
                [120.714077316797002, 31.594044352475724],
                [120.714050762726302, 31.593735728623301],
                [120.71405085208788, 31.593688347065477],
                [120.714059225261778, 31.593641512588302],
                [120.714075694124872, 31.593596277588407],
                [120.714099886387132, 31.593553661913298],
                [120.714131260177155, 31.593514625808371],
                [120.71416910580848, 31.593480048440263],
                [120.714212571367725, 31.593450710140189],
                [120.714260677988406, 31.593427271402291],
                [120.714312341605037, 31.593410258451094],
                [120.714366396703397, 31.593400057604818],
                [120.715279878461985, 31.593288359549938],
                [120.715396183708549, 31.593272173214572],
                [120.715511673837824, 31.593252161904722],
                [120.715626175406811, 31.593228351914536],
                [120.715692028592997, 31.59321350308738],
                [120.715839978139172, 31.593183273971484],
                [120.715989412145049, 31.593158974547844],
                [120.716140006277598, 31.593140656168931],
                [120.716291434178956, 31.593128357539754],
                [120.716443366201005, 31.593122107477335],
                [120.71659547256553, 31.593121917737228],
                [120.716747423414589, 31.593127789618524],
                [120.717006537618843, 31.59314298391503],
                [120.717111265645045, 31.593058959421246],
                [120.717109964151334, 31.592759791488518],
                [120.716771361747291, 31.59274278707888],
                [120.716718647543857, 31.592728220827894],
                [120.716340950431871, 31.592710382678064],
                [120.716306484126832, 31.592708422579509],
                [120.716314568500763, 31.592598120716712],
                [120.71619929237896, 31.59259192934487],
                [120.71608695437331, 31.592585894241019],
                [120.716047064828416, 31.592661916043259],
                [120.715964480270799, 31.59302884085832],
                [120.715625454185243, 31.593211736971369],
                [120.71524456048887, 31.593289087345724],
                [120.71512210581777, 31.593295219988949],
                [120.714887568552399, 31.593294090198505],
                [120.714767172450308, 31.593296111281717],
                [120.714647050133536, 31.593303334060643],
                [120.714527506227725, 31.593315735915759],
                [120.71440884530864, 31.593333287623608],
                [120.714110104366426, 31.593371343662536],
                [120.714014686003196, 31.593474043077812],
                [120.7138868053582, 31.593498221973661],
                [120.713841491273385, 31.593506790155303]
              ]
            ]
          }
        },
        {
          type: "Feature",
          properties: { Id: 0, 名称: "G1", 类型: "公园绿地" },
          geometry: {
            type: "Polygon",
            coordinates: [
              [
                [120.71374027907838, 31.592795784254861],
                [120.71376803936792, 31.593056066507227],
                [120.713785689402428, 31.593221559431843],
                [120.713798781530755, 31.593218490226356],
                [120.714003756047546, 31.593161903157501],
                [120.714023910698629, 31.593148248516588],
                [120.714086704519318, 31.593015993183307],
                [120.714064823929093, 31.592838706474762],
                [120.714003794165592, 31.59269139165837],
                [120.713918631436385, 31.592476537391843],
                [120.713932587355529, 31.592463214640819],
                [120.71394884909104, 31.592451969587749],
                [120.713967000213444, 31.592443091890225],
                [120.713986574952486, 31.592436809832051],
                [120.714007070372887, 31.592433284750864],
                [120.714027959848579, 31.59243260710976],
                [120.714048707835758, 31.59243479421302],
                [120.71406878079182, 31.592439788493817],
                [120.714087665218003, 31.592447462367286],
                [120.71410487667444, 31.592457619831443],
                [120.714119970102303, 31.592470000812991],
                [120.714262570143106, 31.592607346834733],
                [120.714331318438099, 31.592688005917967],
                [120.714456433844177, 31.592854404438391],
                [120.71448701571255, 31.592884719178308],
                [120.714523137945406, 31.5929101821438],
                [120.714563763443934, 31.592930058784173],
                [120.714607725827662, 31.592943780405644],
                [120.714653764227009, 31.592950952784285],
                [120.714869069306204, 31.592968560804632],
                [120.715030559551565, 31.592957642926319],
                [120.715100336672876, 31.592943887092172],
                [120.715168129307742, 31.592924162862584],
                [120.71523324381738, 31.592898671182432],
                [120.715295014035902, 31.592867673392838],
                [120.715352803809211, 31.592831486813097],
                [120.715406024361897, 31.59279048519365],
                [120.715526068223625, 31.592688120773797],
                [120.715650912711581, 31.592531043360129],
                [120.715979155920209, 31.592140728457892],
                [120.716166753800138, 31.591873434234969],
                [120.716169713709945, 31.591869215009154],
                [120.716236535876845, 31.591745137655181],
                [120.716234512392205, 31.591694066754467],
                [120.71622474758712, 31.59164365409368],
                [120.716207412631036, 31.591594753550048],
                [120.716182800082535, 31.591548199603981],
                [120.716151323656845, 31.59150477706639],
                [120.716113524041901, 31.591465224899462],
                [120.71607003721229, 31.591430213276102],
                [120.715550561302265, 31.591127892229551],
                [120.715390036112467, 31.591039150851113],
                [120.714953025203471, 31.590846791138887],
                [120.714896807096508, 31.590823223057615],
                [120.714843850330496, 31.590794649136367],
                [120.714794763185111, 31.590761398444034],
                [120.714750105461974, 31.590723852063046],
                [120.714710385227463, 31.590682437602819],
                [120.714676060728934, 31.590637627537497],
                [120.714548843983735, 31.590450430283713],
                [120.714528315194812, 31.59041666473594],
                [120.714475612597511, 31.590427669430177],
                [120.714502684235796, 31.590472188743806],
                [120.714630522678391, 31.590660302357467],
                [120.714667744255905, 31.590708917960026],
                [120.714710789114847, 31.590753872453899],
                [120.714759173656873, 31.590794657726899],
                [120.71481234643413, 31.590830807329844],
                [120.714869706944313, 31.590861915637085],
                [120.714930606866545, 31.590887631234711],
                [120.715363636846291, 31.591078238679994],
                [120.715521455571277, 31.591165483729423],
                [120.716038338796253, 31.59146629524361],
                [120.716075536178721, 31.591496477307953],
                [120.716107991566389, 31.591530433907593],
                [120.71613518504887, 31.591567619718528],
                [120.716156683837866, 31.591607445993759],
                [120.71617214415437, 31.591649275047931],
                [120.716076435465496, 31.591826989838985],
                [120.715891089339394, 31.592091075442017],
                [120.71556458314555, 31.592479323938292],
                [120.71544459529747, 31.592630290574789],
                [120.715331661202669, 31.592726592713294],
                [120.715287005205894, 31.592761044518227],
                [120.715238556736068, 31.592791509209839],
                [120.715186797086545, 31.592817685749509],
                [120.715132245782542, 31.592839310865639],
                [120.715075445875158, 31.59285617014508],
                [120.715016964550415, 31.592868093626343],
                [120.714869939989924, 31.592878032225954],
                [120.714663785984413, 31.592861173363069],
                [120.714635806952273, 31.592856851454446],
                [120.714609053995673, 31.592848619488347],
                [120.71458426643899, 31.59283670231499],
                [120.714562129131451, 31.592821433527075],
                [120.714543256841367, 31.592803232978749],
                [120.71441825243086, 31.592636980340146],
                [120.714344698488688, 31.592550683008561],
                [120.714198727746108, 31.592410089588206],
                [120.714169951799917, 31.592386677699107],
                [120.714136993958945, 31.592367730154898],
                [120.714100790772463, 31.592353784455174],
                [120.714062365784045, 31.592345233397936],
                [120.714022810199097, 31.592342319683535],
                [120.713983245521973, 31.592345127316559],
                [120.713944790072631, 31.592353575738237],
                [120.713908535892656, 31.592367427111068],
                [120.713875510151126, 31.592386284882998],
                [120.713846648981786, 31.592409620354573],
                [120.713822768504826, 31.592436767335979],
                [120.713804545824942, 31.592466960233484],
                [120.713707008757282, 31.592483834016782],
                [120.71374027907838, 31.592795784254861]
              ]
            ]
          }
        },
        {
          type: "Feature",
          properties: { Id: 0, 名称: "A33b", 类型: "初中用地" },
          geometry: {
            type: "Polygon",
            coordinates: [
              [
                [120.715016964332008, 31.592868092856428],
                [120.715075445885944, 31.592856169196999],
                [120.715132245755896, 31.592839310608866],
                [120.715186797099165, 31.592817685335255],
                [120.715238555513622, 31.592791509189112],
                [120.715287004470881, 31.592761043399388],
                [120.715331660471094, 31.592726592003842],
                [120.715444595025872, 31.592630289242194],
                [120.715564582171112, 31.592479323556471],
                [120.715891088768302, 31.592091075171002],
                [120.716076433969405, 31.591826989496148],
                [120.716172142658337, 31.591649274497556],
                [120.716156683260962, 31.591607446126048],
                [120.716135185223095, 31.591567620284167],
                [120.716107991761774, 31.591530432779432],
                [120.716075537018213, 31.591496477298406],
                [120.716038339126627, 31.591466295928836],
                [120.715521454709474, 31.591165483410428],
                [120.715363636373169, 31.591078237519149],
                [120.714930606463511, 31.590887629937018],
                [120.714869707467713, 31.590861916026633],
                [120.714812346257133, 31.590830807379117],
                [120.714759172641607, 31.590794656406956],
                [120.714710788990047, 31.590753872643994],
                [120.714667743406437, 31.590708918105797],
                [120.714630523520881, 31.590660302055564],
                [120.714502683289368, 31.590472189016197],
                [120.714475613553816, 31.590427668609593],
                [120.713611608835748, 31.590608078618878],
                [120.713518825704853, 31.590719266688087],
                [120.71370700933322, 31.592483832854633],
                [120.713804545436275, 31.592466959930185],
                [120.71382276724988, 31.592436767880358],
                [120.713846647650001, 31.592409619967746],
                [120.713875509889462, 31.592386285532363],
                [120.713908536043519, 31.592367425844188],
                [120.713944790188805, 31.592353575363795],
                [120.71398324492624, 31.592345126596737],
                [120.714022810495834, 31.592342318970463],
                [120.714062365658634, 31.592345232049528],
                [120.714100789470592, 31.592353783280792],
                [120.714136993048243, 31.592367730332835],
                [120.714169950425628, 31.592386677963329],
                [120.714198727628755, 31.592410089219367],
                [120.714344698697104, 31.592550683067547],
                [120.714418251962059, 31.592636980698302],
                [120.714543257204255, 31.592803232111056],
                [120.714562128980518, 31.592821432390853],
                [120.714584265359122, 31.592836702122838],
                [120.714609053422578, 31.592848618513997],
                [120.714635806831893, 31.592856851619548],
                [120.71466378483025, 31.592861173478614],
                [120.714869939150304, 31.592878032354562],
                [120.715016964332008, 31.592868092856428]
              ]
            ]
          }
        },
        {
          type: "Feature",
          properties: { Id: 0, 名称: "河流", 类型: "河流水域" },
          geometry: {
            type: "Polygon",
            coordinates: [
              [
                [120.713841491317481, 31.593506790418633],
                [120.714014686494508, 31.593474042042839],
                [120.714110102903192, 31.593371342368972],
                [120.71440884559982, 31.593333286843713],
                [120.714527505612409, 31.593315735156548],
                [120.714647049415973, 31.593303332835678],
                [120.714767172213087, 31.593296111502656],
                [120.714887567730372, 31.593294089569202],
                [120.715122104662072, 31.593295220055708],
                [120.715244559753145, 31.593289086764727],
                [120.715625452617431, 31.593211736424905],
                [120.715964481182695, 31.593028839750126],
                [120.716047064627787, 31.592661914775306],
                [120.716086953156434, 31.592585894532689],
                [120.716145451723776, 31.592474406716548],
                [120.71618636381001, 31.592354187394282],
                [120.716259008144263, 31.592156866748205],
                [120.716403245441896, 31.592009952966023],
                [120.716851063007368, 31.591641245148136],
                [120.716910585665531, 31.591603015586021],
                [120.716845283972404, 31.591336371520143],
                [120.71665143491532, 31.591373169617668],
                [120.716554525427156, 31.591409641222238],
                [120.716486359303161, 31.591406552535329],
                [120.716366185396808, 31.591365080159385],
                [120.716287263127469, 31.591343571186172],
                [120.71580205043702, 31.591075358284886],
                [120.715562401603862, 31.590921906673298],
                [120.715124323732411, 31.590708136726182],
                [120.715089742592895, 31.590688446219573],
                [120.715058646987742, 31.590664878365466],
                [120.715031625785272, 31.590637879478564],
                [120.715009190693877, 31.5906079608482],
                [120.714831712152119, 31.590371127753478],
                [120.7148206786092, 31.590355614878849],
                [120.714528312100981, 31.590416664586829],
                [120.714548842692921, 31.590450430319748],
                [120.714676060568635, 31.590637627447659],
                [120.714710385102975, 31.59068243650227],
                [120.714750103882267, 31.590723851561542],
                [120.714794762616279, 31.59076139892688],
                [120.714843850510462, 31.590794649137202],
                [120.71489680610847, 31.590823221881248],
                [120.714953023713846, 31.590846790347712],
                [120.715390036973929, 31.591039151269872],
                [120.715550559712469, 31.591127892210622],
                [120.716070037667905, 31.591430214041399],
                [120.716113523731067, 31.591465224794611],
                [120.716151324551888, 31.591504776705662],
                [120.716182798781645, 31.591548198723576],
                [120.716207412408465, 31.591594754134938],
                [120.716224747817847, 31.591643653063016],
                [120.716234510878778, 31.591694065868854],
                [120.716236535934655, 31.591745137227097],
                [120.716169713707075, 31.591869215053745],
                [120.715979156504844, 31.592140727331888],
                [120.715650912252514, 31.592531042409526],
                [120.715526067201836, 31.592688120394552],
                [120.715406023950294, 31.592790485040812],
                [120.715352804322748, 31.592831487135644],
                [120.715295013418782, 31.592867672442324],
                [120.715233243734943, 31.592898669970729],
                [120.715168128562198, 31.592924161918067],
                [120.715100335493091, 31.592943886927337],
                [120.71503055957686, 31.592957642767125],
                [120.714869070119462, 31.592968560108677],
                [120.714653763784327, 31.592950952810824],
                [120.714607726143271, 31.592943779730888],
                [120.714563763708099, 31.592930057812975],
                [120.714523138173675, 31.592910180867872],
                [120.714487015465821, 31.592884719351698],
                [120.714456432279775, 31.592854403993897],
                [120.714331317284604, 31.592688006419721],
                [120.714262569508449, 31.592607346828977],
                [120.714119969487157, 31.592469999732963],
                [120.714104875531959, 31.592457619726542],
                [120.714087665411, 31.592447462036649],
                [120.714068780935662, 31.592439787427168],
                [120.714048706900286, 31.592434792917338],
                [120.714027958636805, 31.592432606724053],
                [120.714007068785406, 31.592433284970323],
                [120.713986573621142, 31.592436810244539],
                [120.713966999286825, 31.592443092047464],
                [120.713948848286435, 31.592451969115391],
                [120.713932586585088, 31.592463213560112],
                [120.71391863164709, 31.592476536718966],
                [120.714003793362167, 31.592691391692878],
                [120.714064824118822, 31.592838705198321],
                [120.714086704760788, 31.593015993243426],
                [120.714023910665631, 31.593148247497304],
                [120.714003756201706, 31.593161901871603],
                [120.713798781589404, 31.59321848916311],
                [120.71378568700132, 31.593221558253109],
                [120.71381650753284, 31.593510545119624],
                [120.713841491317481, 31.593506790418633]
              ]
            ]
          }
        },
        {
          type: "Feature",
          properties: { Id: 0, 名称: "G1", 类型: "公园绿地" },
          geometry: {
            type: "Polygon",
            coordinates: [
              [
                [120.716244565541132, 31.592505643315867],
                [120.716287202454623, 31.592380355234265],
                [120.71635318701415, 31.592201123751426],
                [120.716480314437348, 31.592071637202473],
                [120.716919457917442, 31.591710070904671],
                [120.71693444627374, 31.591700444346934],
                [120.716910585665531, 31.591603015586021],
                [120.716851063007368, 31.591641245148136],
                [120.716403245441896, 31.592009952966023],
                [120.716259008144263, 31.592156866748205],
                [120.71618636381001, 31.592354187394282],
                [120.716145451723776, 31.592474406716548],
                [120.716086953156434, 31.592585894532689],
                [120.716199291207644, 31.592591928311922],
                [120.716244565541132, 31.592505643315867]
              ]
            ]
          }
        },
        {
          type: "Feature",
          properties: { Id: 0, 名称: "G1", 类型: "公园绿地" },
          geometry: {
            type: "Polygon",
            coordinates: [
              [
                [120.71665143491532, 31.591373169617668],
                [120.716845283972404, 31.591336371520143],
                [120.716823665210043, 31.591248096042673],
                [120.716618509916401, 31.591287040375271],
                [120.716457034153649, 31.591347811257979],
                [120.716384051436364, 31.591322624684778],
                [120.716309940615091, 31.591302426996251],
                [120.715832154158363, 31.591038319146744],
                [120.715591336477686, 31.59088411912235],
                [120.715150414470074, 31.590668961347525],
                [120.71512152884921, 31.590652483069142],
                [120.715095599434648, 31.590632727989171],
                [120.715073129627839, 31.590610079640093],
                [120.715054555663116, 31.590584977725136],
                [120.714969663757259, 31.590471695484187],
                [120.715148736089333, 31.590442157485413],
                [120.715108746763008, 31.590295461990028],
                [120.7148206786092, 31.590355614878849],
                [120.714831712152119, 31.590371127753478],
                [120.715009190693877, 31.5906079608482],
                [120.715031625785272, 31.590637879478564],
                [120.715058646987742, 31.590664878365466],
                [120.715089742592895, 31.590688446219573],
                [120.715124323732411, 31.590708136726182],
                [120.715562401603862, 31.590921906673298],
                [120.71580205043702, 31.591075358284886],
                [120.716287263127469, 31.591343571186172],
                [120.716366185396808, 31.591365080159385],
                [120.716486359303161, 31.591406552535329],
                [120.716554525427156, 31.591409641222238],
                [120.71665143491532, 31.591373169617668]
              ]
            ]
          }
        },
        {
          type: "Feature",
          properties: { Id: 0, 名称: "R2", 类型: "二类居住用地" },
          geometry: {
            type: "Polygon",
            coordinates: [
              [
                [120.716618509916401, 31.591287040375271],
                [120.716823665210043, 31.591248096042673],
                [120.716779061172232, 31.591065964666804],
                [120.716700466091766, 31.590597404472756],
                [120.716477276442248, 31.590631796226681],
                [120.716403433909619, 31.590280461620861],
                [120.716386353828071, 31.590231405574116],
                [120.716357192469658, 31.590211604731145],
                [120.716323981502853, 31.590205840903408],
                [120.716280707913739, 31.590209193851901],
                [120.716225529712858, 31.590222558147872],
                [120.716182193107599, 31.590071304145741],
                [120.715108746763008, 31.590295461990028],
                [120.715148736089333, 31.590442157485413],
                [120.714969663757259, 31.590471695484187],
                [120.715054555663116, 31.590584977725136],
                [120.715073129627839, 31.590610079640093],
                [120.715095599434648, 31.590632727989171],
                [120.71512152884921, 31.590652483069142],
                [120.715150414470074, 31.590668961347525],
                [120.715591336477686, 31.59088411912235],
                [120.715832154158363, 31.591038319146744],
                [120.716309940615091, 31.591302426996251],
                [120.716384051436364, 31.591322624684778],
                [120.716457034153649, 31.591347811257979],
                [120.716618509916401, 31.591287040375271]
              ]
            ]
          }
        },
        {
          type: "Feature",
          properties: { Id: 0, 名称: "A1", 类型: "行政办公用地" },
          geometry: {
            type: "Polygon",
            coordinates: [
              [
                [120.716700466091766, 31.590597404472756],
                [120.716698391915472, 31.590585038789822],
                [120.716595816843281, 31.590077547172481],
                [120.716475494935935, 31.590010054895359],
                [120.716182193107599, 31.590071304145741],
                [120.716225529712858, 31.590222558147872],
                [120.716280707913739, 31.590209193851901],
                [120.716323981502853, 31.590205840903408],
                [120.716357192469658, 31.590211604731145],
                [120.716386353828071, 31.590231405574116],
                [120.716403433909619, 31.590280461620861],
                [120.716477276442248, 31.590631796226681],
                [120.716700466091766, 31.590597404472756]
              ]
            ]
          }
        },
        {
          type: "Feature",
          properties: { Id: 0, 名称: "R1", 类型: "一类居住用地" },
          geometry: {
            type: "Polygon",
            coordinates: [
              [
                [120.716470041111961, 31.592716480491173],
                [120.716718647543857, 31.592728220827894],
                [120.716771361747291, 31.59274278707888],
                [120.717109964151334, 31.592759791488518],
                [120.717109675147967, 31.592693188380437],
                [120.717107025376308, 31.592610796397651],
                [120.717099797836525, 31.592528604597305],
                [120.717088009415576, 31.592446801135349],
                [120.717018502091719, 31.592043667322386],
                [120.716934447029331, 31.591700445508021],
                [120.716919458870478, 31.5917100709929],
                [120.716480315559849, 31.592071638571309],
                [120.716353188032286, 31.592201124306339],
                [120.716287202510955, 31.592380355845396],
                [120.716244565489774, 31.592505644575645],
                [120.71619929237896, 31.59259192934487],
                [120.716314568500763, 31.592598120716712],
                [120.716306484126832, 31.592708422579509],
                [120.716340950431871, 31.592710382678064],
                [120.716402442009468, 31.592713288269596],
                [120.716470041111961, 31.592716480491173]
              ]
            ]
          }
        }
      ]
    },
    symbol: {
      type: "polygonC",
      styleOptions: {
        opacity: 0.6,
        color: "#0000FF"
      },
      styleField: "类型",
      styleFieldOptions: {
        一类居住用地: { color: "#FFDF7F" },
        二类居住用地: { color: "#FFFF00" },
        社区服务用地: { color: "#FF6A38" },
        幼托用地: { color: "#FF6A38" },
        商住混合用地: { color: "#FF850A" },
        行政办公用地: { color: "#FF00FF" },
        文化设施用地: { color: "#FF00FF" },
        小学用地: { color: "#FF7FFF" },
        初中用地: { color: "#FF7FFF" },
        体育场用地: { color: "#00A57C" },
        医院用地: { color: "#A5527C" },
        社会福利用地: { color: "#FF7F9F" },
        商业用地: { color: "#FF0000" },
        商务用地: { color: "#7F0000" },
        营业网点用地: { color: "#FF7F7F" },
        一类工业用地: { color: "#A57C52" },
        社会停车场用地: { color: "#C0C0C0" },
        通信用地: { color: "#007CA5" },
        排水用地: { color: "#00BFFF" },
        公园绿地: { color: "#00FF00" },
        防护绿地: { color: "#007F00" },
        河流水域: { color: "#7FFFFF" },
        配建停车场: { color: "#ffffff" },
        道路用地: { color: "#ffffff" }
      }
    },
    popup: "类型:{类型}"
    // flyTo: true,
  })
  map.addLayer(graphicLayer)

  // 下面代码演示如果再config.json中配置的图层，如何绑定额外事件方法
  // 绑定config.json中对应图层配置的"id"值图层的单击事件（比如下面是id:1987对应图层）
  const layerTest = map.getLayerById(1987)
  // 绑定事件
  layerTest.on(mars3d.EventType.load, function (event) {
    console.log("数据加载完成", event)
  })

  layerTest.on(mars3d.EventType.click, function (event) {
    // 单击事件
    console.log("单击了图层", event)
  })
}

/**
 * 立体建筑物
 */
export function showBuilding() {
  removeLayer()

  graphicLayer = new mars3d.layer.GeoJsonLayer({
    name: "建筑物面",
    url: "//data.mars3d.cn/file/geojson/buildings-demo.json",
    symbol: {
      styleOptions: {
        color: "#0d3685",
        outlineColor: "#0d3685",
        opacity: 0.8
      },
      callback: function (attr, styleOpt) {
        const diffHeight = Number(attr.floors || 1) * Number(attr.flo_height)
        return { height: 0, diffHeight: diffHeight }
      }
    },
    center: { lat: 31.928659, lng: 120.420654, alt: 838, heading: 344, pitch: -42 },
    popup: "all",
    flyTo: true
  })
  map.addLayer(graphicLayer)

  // 绑定事件
  graphicLayer.on(mars3d.EventType.load, function (event) {
    console.log("数据加载完成", event)
  })
}

/**
 *  分层分户立体建筑物
 */
export function showFloor() {
  removeLayer()

  graphicLayer = new mars3d.layer.GeoJsonLayer({
    name: "分层分户建筑物面",
    url: "//data.mars3d.cn/file/geojson/huxing.json",
    symbol: {
      styleOptions: {
        color: "#ffffff",
        opacity: 0.2,
        outline: true,
        outlineColor: "#63AEFF",
        outlineOpacity: 0.3,

        highlight: {
          type: "click",
          color: "#00ffff",
          opacity: 0.6
        }
      },
      callback: function (attr, styleOpt) {
        const flrH = attr.floorh || 0 // 底面高度
        const lyrH = attr.layerh || 0 // 楼层高度

        return { height: flrH, diffHeight: lyrH }
      }
    },
    // popup: "all",
    center: { lat: 31.821524, lng: 117.179329, alt: 255, heading: 25, pitch: -48 },
    flyTo: true
  })
  map.addLayer(graphicLayer)

  // 绑定事件
  graphicLayer.on(mars3d.EventType.load, function (event) {
    console.log("数据加载完成", event)
  })
}

/**
 * 行政区划 ，转为wall显示
 */
export function showBoundaryWall() {
  removeLayer()

  map.setCameraView({ lat: 30.561661, lng: 117.663884, alt: 113078, heading: 346, pitch: -43 })

  graphicLayer = new mars3d.layer.GeoJsonLayer({
    name: "合肥市",
    url: "//data.mars3d.cn/file/geojson/areas/340100_full.json",
    symbol: {
      type: "wall",
      styleOptions: {
        diffHeight: 5000, // 墙高
        materialType: mars3d.MaterialType.LineFlow,
        materialOptions: {
          color: "#00ffff", // 颜色
          opacity: 0.6, // 透明度
          image: "img/textures/fence.png", // 图片
          repeatX: 1, // 重复数量
          axisY: true, // 竖直方向
          speed: 10 // 速度
        },
        // 高亮时的样式
        highlight: {
          type: "click",
          color: "#ffff00"
        }
      }
    },
    popup: "{name}"
    // "tooltip": "{name}",
    // flyTo: true,
  })
  map.addLayer(graphicLayer)

  // 绑定事件
  graphicLayer.on(mars3d.EventType.load, function (event) {
    console.log("数据加载完成", event)
  })
  graphicLayer.on(mars3d.EventType.click, function (event) {
    console.log("单击了图层", event)
  })
}

/**
 * 显示特殊面数据（单体化）
 */
let tilesetLayer
export function showMonomer() {
  removeLayer()

  // 三维模型
  if (!tilesetLayer) {
    tilesetLayer = new mars3d.layer.TilesetLayer({
      name: "文庙",
      type: "3dtiles",
      url: "//data.mars3d.cn/3dtiles/qx-simiao/tileset.json",
      position: { alt: 80.6 },
      maximumScreenSpaceError: 1,
      maximumMemoryUsage: 1024,
      show: true
    })
    map.addLayer(tilesetLayer)
  }

  graphicLayer = new mars3d.layer.GeoJsonLayer({
    name: "文庙-单体化",
    url: " //data.mars3d.cn/file/geojson/dth-wm.json",
    symbol: {
      type: "polygonP",
      styleOptions: {
        // 单体化默认显示样式
        color: "rgba(255, 255, 255, 0.01)",
        clampToGround: true,
        classification: true,
        // 单体化鼠标移入或单击后高亮的样式
        highlight: {
          // type: mars3d.EventType.click,
          color: "rgba(255,255,0,0.4)"
        }
      }
    },
    popup: [
      { field: "name", name: "房屋名称" },
      { field: "jznf", name: "建造年份" },
      { field: "ssdw", name: "所属单位" },
      { field: "remark", name: "备注信息" }
    ],
    center: { lat: 33.589442, lng: 119.031613, alt: 254, heading: 5, pitch: -37 },
    flyTo: true
  })
  map.addLayer(graphicLayer)

  // 绑定事件
  graphicLayer.on(mars3d.EventType.load, function (event) {
    console.log("数据加载完成", event)
  })
}

/**
 * 显示世界各国
 */
export function showWorld() {
  removeLayer()

  map.setCameraView({ lat: 22.564341, lng: 89.44688, alt: 10817167, heading: 0, pitch: -87 })

  graphicLayer = new mars3d.layer.GeoJsonLayer({
    name: "国界线",
    url: "//data.mars3d.cn/file/geojson/world.json",
    symbol: {
      type: "polygonP",
      styleOptions: {
        fill: true,
        // color: '#ffffff',
        // opacity: 0.01,
        randomColor: true,
        opacity: 0.5,

        // 高亮时的样式
        highlight: {
          type: "click",
          color: "#ffff00"
        }
      },
      styleField: "name",
      styleFieldOptions: {
        Russia: { clampToGround: true }
      }
    },
    popup: "{name} {name_cn}"
  })
  map.addLayer(graphicLayer)

  // 绑定事件
  graphicLayer.on(mars3d.EventType.load, function (event) {
    console.log("数据加载完成", event)
  })
  graphicLayer.on(mars3d.EventType.click, function (event) {
    console.log("单击了图层", event)
  })
}

// 加载GCJ数据进行纠偏
export function showGCJ02Data() {
  removeLayer()

  const gcjLayer = new mars3d.layer.GeoJsonLayer({
    name: "纠偏前",
    url: "https://geo.datav.aliyun.com/areas_v3/bound/340303.json",
    symbol: {
      styleOptions: {
        fill: false,
        outline: true,
        outlineStyle: {
          color: "#FF0000",
          width: 3
        }
      }
    },
    popup: "纠偏前GCJ02坐标"
  })
  map.addLayer(gcjLayer)

  graphicLayer = new mars3d.layer.GeoJsonLayer({
    name: "纠偏后",
    url: "https://geo.datav.aliyun.com/areas_v3/bound/340303.json",
    chinaCRS: mars3d.ChinaCRS.GCJ02, // 标识数据坐标，内部会纠偏
    symbol: {
      styleOptions: {
        fill: false,
        outline: true,
        outlineStyle: {
          color: "#00ffff",
          width: 3
        }
      }
    },
    popup: "纠偏后WGS坐标",
    flyTo: true
  })
  map.addLayer(graphicLayer)
}
